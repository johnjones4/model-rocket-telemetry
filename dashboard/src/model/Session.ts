import { Index, CSV_HEADERS } from '../consts'

export type TimePlottable = Array<[number, number]>

export type Coordinate = [number, number]

export type Locality = {
  here: Coordinate,
  there: Coordinate,
  bearing: number,
  distance: number
}

export type Attitude = {
  pitch: number,
  roll: number,
  yaw: number
}

export default class Session {
  private data: number[][]
  public timestamp: number | null

  constructor(timestamp: number | null, data: number[][]) {
    this.data = data
    this.timestamp = timestamp
  }

  concat(data: number[][]) : Session {
    return new Session(this.timestamp, this.data.concat(data))
  }

  getTimePlottable (yAxis: Index) : TimePlottable {
    return this.data.map(row => [row[Index.TIMESTAMP], row[yAxis]])
  }

  getCurrentLocality () : Locality | null {
    if (this.data.length === 0) {
      return null
    }
    const current = this.data[this.data.length - 1]
    return {
      here: [
        current[Index.BASE_LAT],
        current[Index.BASE_LON],
      ],
      there: [
        current[Index.ROCKET_LAT],
        current[Index.ROCKET_LON],
      ],
      bearing: current[Index.BEARING],
      distance: current[Index.DISTANCE]
    }
  }

  getCurrentAttitude () : Attitude | null {
    if (this.data.length === 0) {
      return null
    }
    const current = this.data[this.data.length - 1]
    return {
      pitch: current[Index.PITCH],
      roll: current[Index.ROLL],
      yaw: current[Index.YAW],
    }
  }

  getCurrentSeconds () : number {
    if (this.data.length === 0) {
      return 0
    }
    return this.data[this.data.length - 1][Index.TIMESTAMP] - this.data[0][Index.TIMESTAMP]
  }

  getCSV () : string {
    return CSV_HEADERS.join(',') + this.data.map(row => row.map(value => `${value}`).join(',')).join('\n')
  }

  static testData = [[247.728698730469,1014.11358642578,20.6387901306152,-0.152983739972115,0.573689043521881,10.4028940200806,18.7272720336914,-40.5454559326172,-63.2653045654297,38.804836,-77.046921,1.0,2.0,-69.0,38.804836,-77.046921,1.0,2.0,],[248.249374389648,1014.09619140625,20.6476936340332,-0.114737808704376,0.573689043521881,10.4411401748657,19.7272720336914,-41.0,-64.2857131958008,38.804837,-77.046923,1.0,2.0,-69.0,38.804836,-77.046921,1.0,2.0,],[248.768035888672,1014.09619140625,20.6476936340332,-0.114737808704376,0.611934959888458,10.4411401748657,18.4545459747314,-40.6363639831543,-63.1632652282715,38.804838,-77.046925,1.0,2.0,-70.0,38.804836,-77.046921,1.0,2.0,],[249.285781860352,1014.00189208984,20.6565952301025,-0.152983739972115,0.573689043521881,10.4028940200806,19.7272720336914,-40.8181800842285,-64.2857131958008,38.804839,-77.046927,1.0,2.0,-70.0,38.804836,-77.046921,1.0,2.0,],[249.822372436523,1014.01245117188,20.6610469818115,-0.191229671239853,0.497197151184082,10.4411401748657,18.5454540252686,-40.5454559326172,-62.8571434020996,38.80484,-77.046929,1.0,2.0,-71.0,38.804836,-77.046921,1.0,2.0,],[250.334121704102,1014.03356933594,20.6699504852295,-0.152983739972115,0.573689043521881,10.517632484436,20.0,-40.7272720336914,-64.6938781738281,38.804841,-77.046931,1.0,2.0,-70.0,38.804836,-77.046921,1.0,2.0,],[250.818634033203,1014.0546875,20.6788539886475,-0.152983739972115,0.573689043521881,10.4411401748657,19.4545459747314,-40.9090919494629,-64.3877563476562,38.804842,-77.0469330000001,1.0,2.0,-70.0,38.804836,-77.046921,1.0,2.0,],[251.215682983398,1014.02673339844,20.6833057403564,-0.114737808704376,0.611934959888458,10.517632484436,18.6363639831543,-40.0909080505371,-62.8571434020996,38.804843,-77.0469350000001,1.0,2.0,-71.0,38.804836,-77.046921,1.0,2.0,],[251.555847167969,1014.08630371094,20.6922092437744,-0.076491869986057,0.573689043521881,10.5558776855469,18.8181819915771,-40.6363639831543,-63.1632652282715,38.804844,-77.0469370000001,1.0,2.0,-60.0,38.804836,-77.046921,1.0,2.0,],[251.913726806641,1014.08630371094,20.6922092437744,3.09792065620422,1.37685370445251,19.5054264068604,-2.36363625526428,-25.7272720336914,-78.9795913696289,38.804845,-77.0469390000001,1.0,2.0,-63.0,38.804836,-77.046921,1.0,2.0,],[252.316040039062,1013.23950195313,20.6922092437744,1.14737808704376,-0.535443067550659,19.5054264068604,-24.1818180084228,-22.9090900421143,-71.8367309570313,38.804846,-77.0469410000001,1.0,2.0,-71.0,38.804836,-77.046921,1.0,2.0,],[252.819839477539,1011.59497070313,20.6966609954834,0.879656493663788,0.458951234817505,19.5054264068604,-30.5454540252686,-4.81818199157715,-72.5510177612305,38.804847,-77.0469430000001,1.0,2.0,-76.0,38.804836,-77.046921,1.0,2.0,],[253.349182128906,1009.11071777344,20.6877574920654,0.650180876255035,-0.26772153377533,19.5054264068604,-26.0,12.3636360168457,-72.6530609130859,38.804848,-77.0469450000001,1.0,2.0,-80.0,38.804836,-77.046921,1.0,2.0,],[254.103775024414,1006.22772216797,20.7055644989014,0.305967479944229,0.305967479944229,-1.91229677200317,-4.36363649368286,24.0909099578857,-73.2653045654297,38.804849,-77.0469470000001,1.0,2.0,-83.0,38.804836,-77.046921,1.0,2.0,],[254.583892822266,1004.68835449219,20.7055644989014,0.114737808704376,0.076491869986057,-1.07088613510132,4.63636350631714,24.0,-72.8571395874023,38.80485,-77.0469490000001,1.0,2.0,-85.0,38.804836,-77.046921,1.0,2.0,],[254.854446411133,1003.80322265625,20.7055644989014,0.038245934993029,0.0,-0.803164660930633,8.81818199157715,23.0909099578857,-72.5510177612305,38.804851,-77.0469510000001,1.0,2.0,-90.0,38.804836,-77.046921,1.0,2.0,],[255.368881225586,1002.73284912109,1324.30139160156,1.12244631367275e-08,0.076491869986057,-0.076491869986057,16.1818180084229,22.0909099578857,-70.8163299560547,38.804852,-77.0469530000002,1.0,2.0,-89.0,38.804836,-77.046921,1.0,2.0,],[255.894226074219,1001.87908935547,20.7055644989014,0.076491869986057,-0.038245934993029,0.152983739972115,20.4545459747314,24.5454540252686,-64.5918350219727,38.804853,-77.0469550000002,1.0,2.0,-86.0,38.804836,-77.046921,1.0,2.0,],[256.698211669922,1001.11993408203,20.7100162506104,0.076491869986057,0.114737808704376,0.382459342479706,31.1818180084229,29.5454540252686,-48.9795913696289,38.804854,-77.0469570000002,1.0,2.0,-80.0,38.804836,-77.046921,1.0,2.0,],[257.171020507812,1000.96600341797,20.7100162506104,-0.076491869986057,-0.191229671239853,0.191229671239853,28.3636360168457,37.1818199157715,-21.7346935272217,38.804855,-77.0469590000002,1.0,2.0,-81.0,38.804836,-77.046921,1.0,2.0,],[257.649871826172,1001.10229492188,20.7189197540283,-0.114737808704376,-0.305967479944229,-0.152983739972115,25.0,18.9090900421143,11.2244901657105,38.804856,-77.0469610000002,1.0,2.0,-79.0,38.804836,-77.046921,1.0,2.0,],[257.934265136719,1001.33319091797,20.7189197540283,-0.076491869986057,0.076491869986057,-0.076491869986057,12.5454549789429,-9.54545497894287,25.6122455596924,38.804857,-77.0469630000002,1.0,2.0,-79.0,38.804836,-77.046921,1.0,2.0,],[258.414611816406,1001.82299804688,20.7144680023193,0.152983739972115,0.229475617408752,0.076491869986057,3.54545450210571,-15.9090909957886,27.2448978424072,38.804858,-77.0469650000002,1.0,2.0,-80.0,38.804836,-77.046921,1.0,2.0,],[258.91845703125,1002.6416015625,20.7189197540283,5.54566049575806,-6.34882497787476,-19.5054264068604,-4.0,-22.1818180084229,26.1224498748779,38.804859,-77.0469670000002,1.0,2.0,-85.0,38.804836,-77.046921,1.0,2.0,],[259.427886962891,1003.75762939453,20.7189197540283,-0.458951234817505,-10.2881565093994,-19.5054264068604,-0.272727280855179,-3.72727274894714,27.9591827392578,38.80486,-77.0469690000002,1.0,2.0,-83.0,38.804836,-77.046921,1.0,2.0,],[259.899383544922,1003.908203125,20.7011127471924,1.26211583614349,-0.879656493663788,-16.1015377044678,-49.0,-3.90909099578857,6.42857122421265,38.804861,-77.0469710000002,1.0,2.0,-76.0,38.804836,-77.046921,1.0,2.0,],[260.431243896484,1004.14959716797,20.7055644989014,0.726672768592835,1.45334553718567,-3.93933129310608,-23.0,-49.4545440673828,-43.7755088806152,38.804862,-77.0469730000003,1.0,2.0,-96.0,38.804836,-77.046921,1.0,2.0,],[260.954650878906,1004.38049316406,20.7055644989014,2.14177227020264,0.191229671239853,-14.3422260284424,-32.1818199157715,-16.7272720336914,18.9795913696289,38.804863,-77.0469750000003,1.0,2.0,-78.0,38.804836,-77.046921,1.0,2.0,],[261.439178466797,1004.71636962891,20.7011127471924,1.52983736991882,-1.5680832862854,-8.06989192962647,-22.6363639831543,30.8181819915771,11.6326532363892,38.804864,-77.0469770000003,1.0,2.0,-79.0,38.804836,-77.046921,1.0,2.0,],[261.983551025391,1004.79333496094,20.7011127471924,1.49159145355225,-0.114737808704376,-10.7853536605835,-14.4545450210571,-3.54545450210571,27.8571434020996,38.804865,-77.0469790000003,1.0,2.0,-75.0,38.804836,-77.046921,1.0,2.0,],[262.450744628906,1005.11169433594,20.7055644989014,0.229475617408752,1.33860766887665,-8.75831890106201,-1.27272725105286,-2.0,29.2857151031494,38.804866,-77.0469810000003,1.0,2.0,-77.0,38.804836,-77.046921,1.0,2.0,],[263.152160644531,1005.44757080078,20.7011127471924,1.79755890369415,0.879656493663788,-9.67622184753418,-3.90909099578857,0.272727280855179,28.3673477172852,38.804867,-77.0469830000003,1.0,2.0,-76.0,38.804836,-77.046921,1.0,2.0,],[263.608642578125,1005.56304931641,20.7011127471924,0.305967479944229,1.75931298732758,-11.4355344772339,1.45454549789429,3.90909099578857,27.3469390869141,38.804868,-77.0469850000003,1.0,2.0,-75.0,38.804836,-77.046921,1.0,2.0,],[264.113494873047,1005.77642822266,20.7100162506104,0.91790246963501,0.0,-11.0148296356201,8.6363639831543,1.18181812763214,26.2244892120361,38.804869,-77.0469870000003,1.0,2.0,-87.0,38.804836,-77.046921,1.0,2.0,],[264.613342285156,1006.10180664063,20.7011127471924,-0.573689043521881,0.497197151184082,-9.75271320343018,-17.3636360168457,-15.2727270126343,25.8163261413574,38.80487,-77.0469890000003,1.0,2.0,-84.0,38.804836,-77.046921,1.0,2.0,],[265.056457519531,1006.322265625,20.6966609954834,1.26211583614349,1.49159145355225,-9.82920551300049,-11.0,18.0,25.0,38.804871,-77.0469910000003,1.0,2.0,-76.0,38.804836,-77.046921,1.0,2.0,],[265.560333251953,1006.48663330078,20.7011127471924,0.956148386001587,1.10913217067719,-8.94954872131348,9.72727298736572,11.3636360168457,24.3877544403076,38.804872,-77.0469930000004,1.0,2.0,-89.0,38.804836,-77.046921,1.0,2.0,]]
  static testSessions = [1606136199, 1606136051, 1606135946, 1606135804, 1606135665, 1606100505, 1606100017, 1606099802, 1606097904, 1606097677, 1606097331, 1606097091, 1606097042, 1606096819, 1606096672, 1606092404, 1606091928, 1606072251, 1606072206, 1606072073]
}
