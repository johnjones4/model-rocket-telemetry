import { Index } from '../consts'

export type TimePlottable = Array<[number, number]>

export type Coordinate = [number, number]

export type Locality = {
  here: Coordinate,
  there: Coordinate,
  bearing: number,
  distance: number
}

export type Attitude = {
  pitch: number,
  roll: number,
  yaw: number
}

export default class Session {
  private data: number[][]
  public timestamp: number | null

  constructor(timestamp: number | null, data: number[][]) {
    this.data = data
    this.timestamp = timestamp
  }

  concat(data: number[][]) : Session {
    return new Session(this.timestamp, this.data.concat(data))
  }

  getTimePlottable (yAxis: Index) : TimePlottable {
    return this.data.map(row => [row[Index.TIMESTAMP], row[yAxis]])
  }

  getCurrentLocality () : Locality | null {
    if (this.data.length === 0) {
      return null
    }
    const current = this.data[this.data.length - 1]
    return {
      here: [
        current[Index.BASE_LON],
        current[Index.BASE_LAT],
      ],
      there: [
        current[Index.ROCKET_LON],
        current[Index.ROCKET_LAT],
      ],
      bearing: current[Index.BEARING],
      distance: current[Index.DISTANCE]
    }
  }

  getCurrentAttitude () : Attitude | null {
    if (this.data.length === 0) {
      return null
    }
    const current = this.data[this.data.length - 1]
    return {
      pitch: current[Index.PITCH],
      roll: current[Index.ROLL],
      yaw: current[Index.YAW],
    }
  }

  getCurrentSeconds () : number {
    if (this.data.length === 0) {
      return 0
    }
    return this.data[this.data.length - 1][Index.TIMESTAMP] - this.data[0][Index.TIMESTAMP]
  }

  static testData = [[247.72869873046875, 1014.1135864257812, 20.638790130615234, -0.15298373997211456, 0.5736890435218811, 10.402894020080566, 18.727272033691406, -40.54545593261719, -63.26530456542969, -69.0, 38.804836, -77.046921, 38.804, -77.048], [248.24937438964844, 1014.09619140625, 20.647693634033203, -0.11473780870437622, 0.5736890435218811, 10.441140174865723, 19.727272033691406, -41.0, -64.28571319580078, -69.0, 38.804836, -77.046921, 38.804, -77.048], [248.76803588867188, 1014.09619140625, 20.647693634033203, -0.11473780870437622, 0.6119349598884583, 10.441140174865723, 18.454545974731445, -40.6363639831543, -63.163265228271484, -70.0, 38.804836, -77.046921, 38.804, -77.048], [249.28578186035156, 1014.0018920898438, 20.65659523010254, -0.15298373997211456, 0.5736890435218811, 10.402894020080566, 19.727272033691406, -40.818180084228516, -64.28571319580078, -70.0, 38.804836, -77.046921, 38.804, -77.048], [249.82237243652344, 1014.012451171875, 20.661046981811523, -0.1912296712398529, 0.49719715118408203, 10.441140174865723, 18.545454025268555, -40.54545593261719, -62.85714340209961, -71.0, 38.804836, -77.046921, 38.804, -77.048], [250.33412170410156, 1014.0335693359375, 20.669950485229492, -0.15298373997211456, 0.5736890435218811, 10.517632484436035, 20.0, -40.727272033691406, -64.69387817382812, -70.0, 38.804836, -77.046921, 38.804, -77.048], [250.81863403320312, 1014.0546875, 20.67885398864746, -0.15298373997211456, 0.5736890435218811, 10.441140174865723, 19.454545974731445, -40.90909194946289, -64.38775634765625, -70.0, 38.804836, -77.046921, 38.804, -77.048], [251.21568298339844, 1014.0267333984375, 20.683305740356445, -0.11473780870437622, 0.6119349598884583, 10.517632484436035, 18.636363983154297, -40.09090805053711, -62.85714340209961, -71.0, 38.804836, -77.046921, 38.804, -77.048], [251.55584716796875, 1014.0863037109375, 20.692209243774414, -0.07649186998605728, 0.5736890435218811, 10.555877685546875, 18.81818199157715, -40.6363639831543, -63.163265228271484, -60.0, 38.804836, -77.046921, 38.804, -77.048], [251.91372680664062, 1014.0863037109375, 20.692209243774414, 3.0979206562042236, 1.3768537044525146, 19.50542640686035, -2.3636362552642822, -25.727272033691406, -78.9795913696289, -63.0, 38.804836, -77.046921, 38.804, -77.048], [252.3160400390625, 1013.239501953125, 20.692209243774414, 1.1473780870437622, -0.5354430675506592, 19.50542640686035, -24.18181800842285, -22.909090042114258, -71.83673095703125, -71.0, 38.804836, -77.046921, 38.804, -77.048], [252.81983947753906, 1011.594970703125, 20.6966609954834, 0.8796564936637878, 0.4589512348175049, 19.50542640686035, -30.545454025268555, -4.818181991577148, -72.55101776123047, -76.0, 38.804836, -77.046921, 38.804, -77.048], [253.34918212890625, 1009.1107177734375, 20.68775749206543, 0.6501808762550354, -0.2677215337753296, 19.50542640686035, -26.0, 12.363636016845703, -72.65306091308594, -80.0, 38.804836, -77.046921, 38.804, -77.048], [254.10377502441406, 1006.2277221679688, 20.705564498901367, 0.3059674799442291, 0.3059674799442291, -1.9122967720031738, -4.363636493682861, 24.090909957885742, -73.26530456542969, -83.0, 38.804836, -77.046921, 38.804, -77.048], [254.58389282226562, 1004.6883544921875, 20.705564498901367, 0.11473780870437622, 0.07649186998605728, -1.0708861351013184, 4.636363506317139, 24.0, -72.85713958740234, -85.0, 38.804836, -77.046921, 38.804, -77.048], [254.8544464111328, 1003.80322265625, 20.705564498901367, 0.03824593499302864, 0.0, -0.8031646609306335, 8.818181991577148, 23.090909957885742, -72.55101776123047, -90.0, 38.804836, -77.046921, 38.804, -77.048], [255.36888122558594, 1002.7328491210938, 1324.3013916015625, 1.1224463136727536e-08, 0.07649186998605728, -0.07649186998605728, 16.18181800842285, 22.090909957885742, -70.81632995605469, -89.0, 38.804836, -77.046921, 38.804, -77.048], [255.89422607421875, 1001.8790893554688, 20.705564498901367, 0.07649186998605728, -0.03824593499302864, 0.15298373997211456, 20.454545974731445, 24.545454025268555, -64.59183502197266, -86.0, 38.804836, -77.046921, 38.804, -77.048], [256.6982116699219, 1001.1199340820312, 20.71001625061035, 0.07649186998605728, 0.11473780870437622, 0.3824593424797058, 31.18181800842285, 29.545454025268555, -48.979591369628906, -80.0, 38.804836, -77.046921, 38.804, -77.048], [257.1710205078125, 1000.9660034179688, 20.71001625061035, -0.07649186998605728, -0.1912296712398529, 0.1912296712398529, 28.363636016845703, 37.181819915771484, -21.73469352722168, -81.0, 38.804836, -77.046921, 38.804, -77.048], [257.6498718261719, 1001.102294921875, 20.71891975402832, -0.11473780870437622, -0.3059674799442291, -0.15298373997211456, 25.0, 18.909090042114258, 11.22449016571045, -79.0, 38.804836, -77.046921, 38.804, -77.048], [257.93426513671875, 1001.3331909179688, 20.71891975402832, -0.07649186998605728, 0.07649186998605728, -0.07649186998605728, 12.545454978942871, -9.545454978942871, 25.612245559692383, -79.0, 38.804836, -77.046921, 38.804, -77.048], [258.41461181640625, 1001.822998046875, 20.714468002319336, 0.15298373997211456, 0.22947561740875244, 0.07649186998605728, 3.545454502105713, -15.909090995788574, 27.244897842407227, -80.0, 38.804836, -77.046921, 38.804, -77.048], [258.91845703125, 1002.6416015625, 20.71891975402832, 5.545660495758057, -6.348824977874756, -19.50542640686035, -4.0, -22.18181800842285, 26.12244987487793, -85.0, 38.804836, -77.046921, 38.804, -77.048], [259.4278869628906, 1003.7576293945312, 20.71891975402832, -0.4589512348175049, -10.288156509399414, -19.50542640686035, -0.27272728085517883, -3.7272727489471436, 27.959182739257812, -83.0, 38.804836, -77.046921, 38.804, -77.048], [259.8993835449219, 1003.908203125, 20.701112747192383, 1.2621158361434937, -0.8796564936637878, -16.101537704467773, -49.0, -3.909090995788574, 6.4285712242126465, -76.0, 38.804836, -77.046921, 38.804, -77.048], [260.4312438964844, 1004.1495971679688, 20.705564498901367, 0.7266727685928345, 1.453345537185669, -3.939331293106079, -23.0, -49.45454406738281, -43.775508880615234, -96.0, 38.804836, -77.046921, 38.804, -77.048], [260.95465087890625, 1004.3804931640625, 20.705564498901367, 2.1417722702026367, 0.1912296712398529, -14.342226028442383, -32.181819915771484, -16.727272033691406, 18.979591369628906, -78.0, 38.804836, -77.046921, 38.804, -77.048], [261.4391784667969, 1004.7163696289062, 20.701112747192383, 1.5298373699188232, -1.5680832862854004, -8.069891929626465, -22.636363983154297, 30.81818199157715, 11.63265323638916, -79.0, 38.804836, -77.046921, 38.804, -77.048], [261.9835510253906, 1004.7933349609375, 20.701112747192383, 1.491591453552246, -0.11473780870437622, -10.785353660583496, -14.454545021057129, -3.545454502105713, 27.85714340209961, -75.0, 38.804836, -77.046921, 38.804, -77.048], [262.45074462890625, 1005.1116943359375, 20.705564498901367, 0.22947561740875244, 1.338607668876648, -8.758318901062012, -1.2727272510528564, -2.0, 29.285715103149414, -77.0, 38.804836, -77.046921, 38.804, -77.048], [263.15216064453125, 1005.4475708007812, 20.701112747192383, 1.7975589036941528, 0.8796564936637878, -9.67622184753418, -3.909090995788574, 0.27272728085517883, 28.367347717285156, -76.0, 38.804836, -77.046921, 38.804, -77.048], [263.608642578125, 1005.5630493164062, 20.701112747192383, 0.3059674799442291, 1.7593129873275757, -11.435534477233887, 1.454545497894287, 3.909090995788574, 27.346939086914062, -75.0, 38.804836, -77.046921, 38.804, -77.048], [264.1134948730469, 1005.7764282226562, 20.71001625061035, 0.9179024696350098, 0.0, -11.014829635620117, 8.636363983154297, 1.1818181276321411, 26.224489212036133, -87.0, 38.804836, -77.046921, 38.804, -77.048], [264.61334228515625, 1006.101806640625, 20.701112747192383, -0.5736890435218811, 0.49719715118408203, -9.752713203430176, -17.363636016845703, -15.272727012634277, 25.816326141357422, -84.0, 38.804836, -77.046921, 38.804, -77.048], [265.05645751953125, 1006.322265625, 20.6966609954834, 1.2621158361434937, 1.491591453552246, -9.829205513000488, -11.0, 18.0, 25.0, -76.0, 38.804836, -77.046921, 38.804, -77.048], [265.5603332519531, 1006.4866333007812, 20.701112747192383, 0.9561483860015869, 1.109132170677185, -8.949548721313477, 9.727272987365723, 11.363636016845703, 24.387754440307617, -89.0, 38.804836, -77.046921, 38.804, -77.048], [266.08782958984375, 1006.7945556640625, 20.701112747192383, -0.49719715118408203, 0.6119349598884583, -9.637975692749023, -28.545454025268555, -10.727272987365723, 22.5510196685791, -78.0, 38.804836, -77.046921, 38.804, -77.048], [266.5865478515625, 1006.8715209960938, 20.701112747192383, -0.5736890435218811, 0.7266727685928345, -8.605335235595703, -22.727272033691406, -27.545454025268555, 19.183673858642578, -84.0, 38.804836, -77.046921, 38.804, -77.048], [267.1139221191406, 1007.0814819335938, 20.692209243774414, 0.9943943023681641, 0.49719715118408203, -9.217269897460938, -29.0, 20.909090042114258, 15.714285850524902, -74.0, 38.804836, -77.046921, 38.804, -77.048]]
  static testSessions = [1606136199, 1606136051, 1606135946, 1606135804, 1606135665, 1606100505, 1606100017, 1606099802, 1606097904, 1606097677, 1606097331, 1606097091, 1606097042, 1606096819, 1606096672, 1606092404, 1606091928, 1606072251, 1606072206, 1606072073]
}
